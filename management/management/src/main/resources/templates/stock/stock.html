<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pharmacy Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    
    
    <style>
      /* Body Styles */
body {
	background-image: url('https://wallpaperset.com/w/full/f/6/7/142016.jpg');
    background-color: #f4f4f9;
    font-family: 'Arial', sans-serif;
    color: #333;
    margin: 0;
    padding: 0;
}

/* Container for content */
.container {
    width: 90%; /* or use fixed: e.g., 1200px */
    max-width: 1400px; 
    margin: 0 auto;
    padding: 20px;
    background-color: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
}

/* Primary Button Styling */
.btn-primary {
    background-color: #ff5733; /* Attractive primary color */
    border: none;
    color: white;
    font-weight: bold;
    padding: 10px 20px;
    border-radius: 5px;
    transition: background-color 0.3s ease, transform 0.3s ease;
}

.btn-primary:hover {
    background-color: #43a800; /* Darker shade on hover */
    transform: scale(1.05); /* Subtle button scale on hover */
}

/* Logo Styling */
.logo {
    max-width: 120px;
    margin-bottom: 20px;
}

/* Header Styling */
h1 {
    font-size: 28px;
    font-weight: bold;
    color: #333;
    margin-bottom: 30px;
}

/* Table Styles */
table {
    width: 100%;
   
    border-collapse: collapse;
    margin-top: 20px;
}
table td,
table th {
    background-color: #f26161;
}

th, td {
    padding: 12px;
    text-align: center;
    font-size: 16px;
    border-bottom: 1px solid #ddd;
}

th {
    background-color: #f26161;
    color: #333;
}

tr:hover {
    background-color: #f9f9f9;
    cursor: pointer;
}

/* Navbar Styles */
.navbar-custom {
    background-color: #ff0000; /* Primary color for navbar */
    padding: 15px 0;
}

.navbar-custom .navbar-brand {
    color: white;
    font-size: 24px;
    font-weight: bold;
    text-decoration: none;
}

.navbar-custom .nav-link {
    color: white;
    font-size: 16px;
    font-weight: bold;
    margin-right: 92px;
    text-decoration: none;
}

.navbar-custom .nav-link:hover {
    color: #ffc107;
}

/* Search Form Styles */
.search-form {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
}

.search-form h4 {
    color: #333;
    margin-right: 15px;
}

.search-form input {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    width: 250px;
}

.search-form button, .search-form a {
    padding: 10px 15px;
    background-color: #007bff;
    color: white;
    border-radius: 5px;
    font-size: 16px;
    margin-left: 10px;
    text-decoration: none;
    border: none;
    transition: background-color 0.3s ease;
}

.search-form button:hover, .search-form a:hover {
    background-color: #0056b3;
}

/* Card and Action Buttons Styling */
.card {
    padding: 15px;
    margin-bottom: 20px;
    background-color: #ffffff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.card h5 {
    font-size: 20px;
    font-weight: bold;
    color: #333;
}

.card-body {
    padding: 15px;
}

.card-body .btn {
    font-size: 14px;
    margin-top: 10px;
    padding: 8px 15px;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .container {
        padding: 15px;
        max-width: 100%;
    }

    .search-form input {
        width: 180px;
    }

    .navbar-custom .navbar-brand {
        font-size: 20px;
    }

    .navbar-custom .nav-link {
        font-size: 14px;
    }
}

        
    </style>
</head>
<body>
	

	<nav class="navbar navbar-expand-lg navbar-custom">
	    <div class="container-fluid">
	        <a class="navbar-brand" href="#">+PharmaPlus+</a>
	        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	            <span class="navbar-toggler-icon"></span>
	        </button>
	        <div class="collapse navbar-collapse" id="navbarNav">
	            <ul class="navbar-nav">
	                <li class="nav-item">
	                    <a class="nav-link" href="/supplier/home"><i class="glyphicon glyphicon-home"></i> Home</a>
	                </li>
	                <li>   <li>
	                <li class="nav-item">
	                    <a class="nav-link active" aria-current="page" href="/stock"><i class="glyphicon glyphicon-th-large"></i> Stock</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link" href="/supplier"><i class="fas fa-handshake"></i> Supplier</a>
	                </li>
	                	                
	                
	                
	                <li class="nav-item">
	                    <a class="nav-link" href="/invoice"><i class="fas fa-file-invoice"></i> Bill</a>
	                </li>
	                <li class="nav-item">
				        <a class="nav-link" href="/expert"><i class="fas fa-user-friends"></i> Ask Expert</a>
			        </li>
	                <li class="nav-item">
	                    <a class="nav-link" href="/info"><i class="fas fa-info-circle"></i> About Us</a>
	                </li>
                    <li class="nav-item">
	                    <a class="nav-link" href="/stock/login"><i class="fas fa-sign-out-alt"></i>Logout</a>
	                </li>  
	            </ul>
	        </div>
	    </div>
	</nav>

    <div class="container">
    	

        <img src="https://seeklogo.com/images/P/pharmacy-logo-4729C66E18-seeklogo.com.png" alt="Pharmacy Logo" class="logo"> <!-- Add your logo image -->
        <h1 class="text-center my-4">HANDLING STOCK DETAIL</h1>    
               
        
         <a class="btn btn-primary" href="/stock/create">
         	<i class="fas fa-plus-circle"></i> Add Stock 
     	</a> 
     	
     	<a class="btn btn-primary" href="/stock/dashboard">
         	<i class="far fa-file-alt"></i> Analysis Report
     	</a>      	
     	<a class="btn btn-primary" href="#" id="exportBtn" onclick="event.preventDefault(); exportToCSV();">
            <i class="fas fa-file-export"></i> Export to CSV
        </a>
     	
     	<br><br>
	    <form th:action="@{/searchDrug}" method="get" class="search-form">
	        <h4>Search :</h4>
	        <input type="text" name="keyword" placeholder="Enter Drug Name" required>
	        <button type="submit" class="btn btn-secondary">
	            <i class="glyphicon glyphicon-search"></i> Search
	        </button>
	        <a class="btn btn-secondary" href="/stock">
	            <i class="fas fa-undo"></i> Reset
	        </a>
	    </form>
	    
 	
 	
        
        <table class="table">
            <thead>
	            <tr>
	                
	                <th style="display: none;">DrugID</th>
		            <th>DrugName</th>
		            <th>DrugCategory</th>
		            <th>Manufacturer</th>
		            <th>ManufacturedDate</th>
		            <th>ExpireDate</th>
                    <th>Use</th>
                    <th>SideEffects</th>
		            <th>Quantity</th>
		            <th>UnitPrice</th>
		            
	                <th>Action</th>
                   
	            </tr>
	        </thead>
	        <tbody>
	            <tr th:each="stock : ${stocks}">
	                
				    <td style="display: none;" th:text="${stock.drugID}"></td>
				    <td th:text="${stock.drugName}"></td>
				    <td th:text="${stock.drugCategory}"></td>
				    <td th:text="${stock.manufacturer}"></td>
				    <td th:text="${stock.manufacturedDate}"></td>
				    <td th:text="${stock.expiredDate}"></td>
                    <td th:text="${stock.sideEffect}"></td>
                    <td th:text="${stock.drugUse}"></td>
                   
				    <td th:text="${stock.quantity}"></td>
				    <td th:text="'â‚¹' + ${stock.price}"></td>
				    	                
	                
	                
	                <td style="white-space:nowrap">
	                
                		<a class="btn btn-primary btn-sm" th:href="@{/stock/view/{drugID}(drugID=${stock.drugID})}">
                        	<i class="fas fa-eye"></i> View
                        </a>
                        
                        <a class="btn btn-primary btn-sm" th:href="@{/stock/edit/{drugID}(drugID=${stock.drugID})}">
                        	<i class="glyphicon glyphicon-edit"></i> Edit
                        </a>                       
                        
                        
                        <a class="btn btn-danger btn-sm" th:href="@{/stock/delete/{drugID}(drugID=${stock.drugID})}" onclick="return confirm('Are you sure?')">
                        	
                        	<i class="glyphicon glyphicon-trash"></i> Delete

                        </a>
                    </td>
	            </tr>
	        </tbody>
        </table>
    
    <!-- Right before closing </body> tag -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
// Fixed export function with proper column mapping
function exportToCSV() {
    const rows = [];
    const table = document.querySelector('table');
    
    // Get visible headers (skip hidden and Action columns)
    const headers = Array.from(table.querySelectorAll('thead th'))
        .filter(th => th.style.display !== 'none' && !th.textContent.includes('Action'))
        .map(th => th.textContent.trim());
    rows.push(headers.join(','));
    
    // Process data rows with correct column order
    table.querySelectorAll('tbody tr').forEach(row => {
        const cells = Array.from(row.querySelectorAll('td'))
            .filter(td => td.style.display !== 'none' && 
                         !td.closest('th')?.textContent.includes('Action'));
        
        // Manually reorder columns to match headers
        if (cells.length >= 9) { // Ensure we have enough cells
            const rowData = [
                cells[0].textContent.trim(),  // DrugName
                cells[1].textContent.trim(),  // DrugCategory
                cells[2].textContent.trim(),  // Manufacturer
                cells[3].textContent.trim(),  // ManufacturedDate
                cells[4].textContent.trim(),  // ExpireDate
                cells[6].textContent.trim(),  // Use (originally drugUse)
                cells[5].textContent.trim(),  // SideEffects (originally sideEffect)
                cells[7].textContent.trim(),  // Quantity
                cells[8].textContent.trim().replace('â‚¹', '')  // Price (remove currency)
                
].map(text => {
    // Format dates explicitly if needed
    if (text.match(/\d{4}-\d{2}-\d{2}/)) { // If it looks like a date
        return `"${text}"`; // Ensure dates are properly quoted
    }
    return `"${text.replace(/"/g, '""')}"`;
});
            
            rows.push(
                rowData.map(text => `"${text.replace(/"/g, '""')}"`).join(',')
            );
        }
    });
    
    // Create download
    const csvContent = "data:text/csv;charset=utf-8," + rows.join('\n');
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "stock_data.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Attach event listener to the button
document.getElementById('exportBtn').addEventListener('click', function(e) {
    e.preventDefault(); // Prevent default link behavior
    exportToCSV();
});
</script>
</body>
</html>
